


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">

    <!-- non-retina iPad pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-72x72.png" sizes="72x72">

    <!-- retina iPhone pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-114x114.png" sizes="114x114">

    <!-- retina iPad pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-144x144.png" sizes="144x144">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/resharper/devguide/apple-touch-icon-precomposed.png">

    <!-- normal favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/resharper/devguide/favicon.ico">
    <link rel="icon" type="image/png" href="/resharper/devguide/favicon.png">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="Extensions/Plugins/Testing/TemporarySettings">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="https://youtrack.jetbrains.com/issues/IJSDK">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="temporary-settings-in-tests" class="elem-anchor"></a>
<h1>Temporary Settings in Tests<a href="#temporary-settings-in-tests" class="anchor-link"><span></span></a></h1>

<p>The ReSharper test environment will use default values for settings. If your test needs particular values in the settings, you need to set them yourself in the test, and they should be reset at the end of the test. This is important because ReSharper will try to reuse the current project and solution for future tests.</p>

<p>The <code class="code highlight language-text">BaseTest</code> class provides two methods to help with this:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">BaseTest</span> <span class="p">:</span> <span class="n">BaseTestNoShell</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">ExecuteWithinSettingsTransaction</span><span class="p">(</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">IContextBoundSettingsStore</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">);</span>
  <span class="k">public</span> <span class="n">ChangeSettingsTemporarilyCore</span> <span class="nf">ChangeSettingsTemporarily</span><span class="p">(</span><span class="n">Lifetime</span> <span class="n">lifetime</span><span class="p">);</span>

  <span class="c1">// […snip…]</span>
<span class="p">}</span></code></pre>

<p>Normally, you would use the <code class="code highlight language-text">ExecuteWithinSettingsTransaction</code> method. This takes an action that receives an instance of <code class="code highlight language-text">IContextBoundSettingsStore</code>, and your code will use this settings store to temporarily change the settings. Once the action is complete, the changes to the settings are automatically undone.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">MyTest</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">ExecuteWithinSettingsTransaction</span><span class="p">(</span><span class="n">store</span> <span class="p">=&gt;</span> <span class="p">{</span>

    <span class="c1">// Update settings</span>
    <span class="n">store</span><span class="p">.</span><span class="n">SetValue</span><span class="p">((</span><span class="n">CSharpLanguageProjectSettings</span> <span class="n">s</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="n">s</span><span class="p">.</span><span class="n">LanguageLevel</span> <span class="p">=</span> <span class="n">CSharpLanguageLevel</span><span class="p">.</span><span class="n">CSharp50</span>
    <span class="p">});</span>

    <span class="c1">// Do test</span>
    <span class="c1">// […snip…]</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre>

<a name="advanced-usage" class="elem-anchor"></a>
<h2>Advanced Usage<a href="#advanced-usage" class="anchor-link"><span></span></a></h2>

<p>The <code class="code highlight language-text">ChangeSettingsTemporarily</code> method does all of the work. It creates an instance of <code class="code highlight language-text">ChangeSettingsTemporarilyCore</code> using the <code class="code highlight language-text">Lifetime</code> you pass in. It creates a new in-memory settings layer with a very high priority, which means it overrides all other layers (project, solution, global), and any writes against the settings store will go to this temporary layer. The layer is created with the given <code class="code highlight language-text">Lifetime</code> instance, and when the <code class="code highlight language-text">Lifetime</code> terminates, the layer is automatically removed and cleaned up. Should you need it, you can get access to the layer’s storage from the returned instance of <code class="code highlight language-text">ChangeSettingsTemporarilyCore</code>.</p>

<p>The <code class="code highlight language-text">ExecuteWithinSettingsTransaction</code> method makes this an easier API to consume. It creates a new <code class="code highlight language-text">Lifetime</code> instance, calls <code class="code highlight language-text">ChangeSettingsTemporarily</code> and then gets a bound settings store accessor which it uses in a call to the passed in action. Once the action completes, the <code class="code highlight language-text">Lifetime</code> is terminated, which cleans up the store accessor, and the instance of <code class="code highlight language-text">ChangeSettingsTemporarilyCore</code>, and therefore removes the temporary settings layer.</p>


                    <div class="last-modified">
                        Last modified: 12 August 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

