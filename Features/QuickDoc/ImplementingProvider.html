


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">

    <!-- non-retina iPad pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-72x72.png" sizes="72x72">

    <!-- retina iPhone pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-114x114.png" sizes="114x114">

    <!-- retina iPad pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-144x144.png" sizes="144x144">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/resharper/devguide/apple-touch-icon-precomposed.png">

    <!-- normal favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/resharper/devguide/favicon.ico">
    <link rel="icon" type="image/png" href="/resharper/devguide/favicon.png">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="Features/QuickDoc/ImplementingProvider">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="https://youtrack.jetbrains.com/issues/IJSDK">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="implementing-iquickdocprovider" class="elem-anchor"></a>
<h1>Implementing IQuickDocProvider<a href="#implementing-iquickdocprovider" class="anchor-link"><span></span></a></h1>

<p>The <code class="code highlight language-text">IQuickDocProvider</code> interface provides two methods:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IQuickDocProvider</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="nf">CanNavigate</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">context</span><span class="p">);</span>
  <span class="k">void</span> <span class="nf">Resolve</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">IQuickDocPresenter</span><span class="p">,</span> <span class="n">PsiLanguageType</span><span class="p">&gt;</span> <span class="n">resolved</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p><strong><code class="code highlight language-text">CanNavigate</code></strong> is called to see if the provider can generate documentation based on the given <code class="code highlight language-text">IDataContext</code>. If it returns true, no other providers are checked. If it returns false, the <code class="code highlight language-text">QuickDocManager</code> continues to other providers.</p>

<p>The provider queries the passed in <code class="code highlight language-text">IDataContext</code> to find data that it needs to provide documentation. This might be using <code class="code highlight language-text">DataConstants.DOCUMENT</code> and <code class="code highlight language-text">DataConstants.DOCUMENT_OFFSET</code> to get the current document and offset, in order to get the PSI tree node at the text caret location, or it might be using <code class="code highlight language-text">DataConstants.DECLARED_ELEMENTS</code> to get the <code class="code highlight language-text">IDeclaredElement</code> at the text caret. The requirements here depend on what the provider wants to document. (See <code class="code highlight language-text">IDataContext</code> for more details.)</p>

<p><strong><code class="code highlight language-text">Resolve</code></strong> is called by the <code class="code highlight language-text">QuickDocManager</code> when initially displaying the documentation (the name makes more sense when dealing with navigation from one presenter to another). The <code class="code highlight language-text">IDataContext</code> is passed in, from which the provider should extract whatever data is required in order to be able to display documentation, and this data is used to create an instance of <code class="code highlight language-text">IQuickDocPresenter</code>. The provider then retrieves the <code class="code highlight language-text">PsiLanguageType</code> of the item being documented, and calls the passed in <code class="code highlight language-text">resolved</code> action. (This action, provided by <code class="code highlight language-text">ShowQuickDocAction</code>, is responsible for creating and managing the popup window and the web browser used to host the HTML).</p>

<aside class="note">
  <p> Retrieving the language can be done using the document from the <code class="code highlight language-text">IDataContext</code>, and passing it, together with instances of <code class="code highlight language-text">DocumentManager</code> and <code class="code highlight language-text">ISolution</code> (injected into the constructor of your component) to the <code class="code highlight language-text">PresentationUtil.GetPresentationLanguageByContainer</code> method:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">var</span> <span class="n">document</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">DataConstants</span><span class="p">.</span><span class="n">DOCUMENT</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">document</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
  <span class="n">projectFile</span> <span class="p">=</span> <span class="n">myDocumentManager</span><span class="p">.</span><span class="n">TryGetProjectFile</span><span class="p">(</span><span class="n">document</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">defaultLanguage</span> <span class="p">=</span> <span class="n">PresentationUtil</span><span class="p">.</span><span class="n">GetPresentationLanguageByContainer</span><span class="p">(</span><span class="n">projectFile</span><span class="p">,</span> <span class="n">mySolution</span><span class="p">);</span>
<span class="n">resolved</span><span class="p">(</span><span class="n">presenter</span><span class="p">,</span> <span class="n">defaultLanguage</span><span class="p">);</span></code></pre>
</aside>

<p>You need to decorate your <code class="code highlight language-text">IQuickDocProvider</code> class with <code class="code highlight language-text">QuickDocProviderAttribute</code>, and pass a priority into the constructor. The list of providers maintained by <code class="code highlight language-text">QuickDocManager</code> is an ordered list, with the lowest priority being at the start of the list (any new items being added to the <code class="code highlight language-text">QuickDocManager</code>’s <code class="code highlight language-text">IViewable&lt;IQuickDocProvider&gt;</code> are inserted in the correct position in the list). The majority of the default providers have a priority of <code class="code highlight language-text">0</code>. You only need to provide a higher or lower priority if the items you’re intending to document are also handled by the default providers, and you wish to override or provide a fallback.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">QuickDocProviderAttribute</span> <span class="p">:</span> <span class="n">SolutionComponentAttribute</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="nf">QuickDocProviderAttribute</span><span class="p">(</span><span class="kt">int</span> <span class="n">priority</span><span class="p">);</span>
	<span class="k">public</span> <span class="kt">int</span> <span class="n">Priority</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre>

<aside class="note">
  <p> If an <code class="code highlight language-text">IQuickDocProvider</code> or <code class="code highlight language-text">IQuickDocPresenter</code> is displaying the QuickDoc information for an instance of <code class="code highlight language-text">IDeclaredElement</code>, they should not store the declared element as a field, as the presenter can last longer than the lifetime of the declared element. E.g. if the QuickDoc window is pinned, and the text of the file is edited, the declared element may become invalid.</p>

  <p>Instead, the presenter should create a <code class="code highlight language-text">DeclaredElementEnvoy</code>, which can both cache the presentation of the element, and recreate a valid element, with a call to <code class="code highlight language-text">GetValidDeclaredElement</code>.</p>
</aside>


                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

